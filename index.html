<!DOCTYPE html>
<html lang="en" data-theme="dark">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1, viewport-fit=cover" />
  <title>Y2K | Roast Records</title>

  <meta name="description" content="Official Web3 submission portal for Y2K | Roast Records. Submit your glitch-dub-trap track and join the movement." />
  <meta name="theme-color" content="#0b0d12" />
  <link rel="icon" href="https://raw.githubusercontent.com/LandoCrissian/Y2kCoin-Website/refs/heads/main/AC6583AD-EE37-486D-8220-6555D24B0D9D.png" />
  <link rel="stylesheet" href="https://fonts.googleapis.com/css2?family=Orbitron:wght@600&family=Space+Mono&display=swap" />

  <script src="https://cdnjs.cloudflare.com/ajax/libs/gsap/3.12.5/gsap.min.js"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/gsap/3.12.5/ScrollTrigger.min.js"></script>

  <style>
    :root {
      --bg: #0b0d12; 
      --txt: #f1f1f1;
      --accent: #00ffc3; 
      --pink: #ff00aa;
      --danger: #ff0044; 
      --verified: #00ff88;
      --card: #13151a;
    }
    * { margin: 0; padding: 0; box-sizing: border-box; }
    html, body { height: 100%; background: var(--bg); color: var(--txt); font-family: 'Space Mono', monospace; overflow-x: hidden; }
    h1, h2, h3 { font-family: 'Orbitron', sans-serif; text-transform: uppercase; }
    #bgCanvas { position: fixed; top: 0; left: 0; width: 100%; height: 100%; z-index: -1; }
    header { position: sticky; top: 0; z-index: 1000; display: flex; align-items: center; justify-content: space-between; padding: 0.8rem 1.2rem; background: rgba(11,13,18,0.85); backdrop-filter: blur(6px); border-bottom: 1px solid #222; }
    .nav-links { display: flex; gap: 0.6rem; align-items: center; }
    .icon-btn { display: flex; align-items: center; justify-content: center; padding: 0.4rem 0.9rem; border-radius: 20px; border: 1px solid var(--accent); background: transparent; transition: 0.25s; }
    .icon-btn img { height: 20px; width: 20px; }
    .icon-btn:hover { background: var(--accent); box-shadow: 0 0 10px var(--accent); transform: translateY(-2px); }
    #connectBtn { margin-left: 1rem; background: var(--accent); color: #000; font-weight: bold; padding: 0.5rem 1rem; border: none; border-radius: 20px; cursor: pointer; transition: 0.25s; }
    #connectBtn.disconnect { background: var(--danger); color: #fff; }
    #walletStatus { text-align: right; font-size: 0.75rem; color: gray; }
    .container { max-width: 1000px; margin: auto; padding: 2rem 1rem; }
    .section { margin-top: 3rem; opacity: 0; transform: translateY(40px); }
    .btn { padding: 0.6rem 1.2rem; background: var(--accent); color: #000; border: none; border-radius: 20px; font-weight: bold; cursor: pointer; }
    .card { background: var(--card); padding: 1rem; border-radius: 8px; box-shadow: 0 0 8px rgba(0, 255, 195, 0.2); margin-bottom: 1rem; }
    input, select, textarea { font-size: 16px; padding: 0.55rem 0.75rem; margin: 0.5rem 0; background: #1a1c20; border: 1px solid #333; border-radius: 6px; color: var(--txt); width: 100%; box-sizing: border-box; }
    audio { width: 100%; margin-top: 0.5rem; border-radius: 6px; }
    footer { text-align: center; padding: 2rem 1rem; margin-top: 4rem; border-top: 1px solid #222; background: rgba(11, 13, 18, 0.85); }
    footer img { height: 60px; margin-bottom: 0.8rem; animation: pulse 3s infinite; }
    footer a { color: var(--accent); margin: 0 0.5rem; text-decoration: none; }
    footer a:hover { text-shadow: 0 0 6px var(--accent); }
    @keyframes pulse { 0%, 100% { filter: drop-shadow(0 0 2px var(--accent)); } 50% { filter: drop-shadow(0 0 8px var(--pink)); } }
    #toast-container { position: fixed; bottom: 1.2rem; right: 1.2rem; display: flex; flex-direction: column; gap: 0.5rem; z-index: 2000; }
    .toast { background: #1c1c1c; color: #fff; padding: 0.8rem 1rem; border-radius: 6px; box-shadow: 0 2px 10px rgba(0, 0, 0, 0.4); font-size: 0.85rem; min-width: 180px; opacity: 0; transform: translateY(20px); transition: opacity 0.3s ease, transform 0.3s ease; }
    .toast.show { opacity: 1; transform: translateY(0); }
    
  </style>
</head>
<body>
<canvas id="bgCanvas"></canvas>
<header>
  <div class="nav-links">
    <a class="icon-btn" href="https://x.com/y2kc0in?s=21" target="_blank"><img src="https://raw.githubusercontent.com/LandoCrissian/Y2kCoin-Website/refs/heads/main/IMG_7358.jpeg" alt="X"/></a>
    <a class="icon-btn" href="https://discord.gg/jpFbSapSAh" target="_blank"><img src="https://raw.githubusercontent.com/LandoCrissian/Y2kCoin-Website/refs/heads/main/IMG_7356.jpeg" alt="Discord"/></a>
    <a class="icon-btn" href="https://obsidian.finance/?outputCurrency=0xB4Df7d2A736Cc391146bB0dF4277E8F68247Ac6d" target="_blank"><img src="https://raw.githubusercontent.com/LandoCrissian/Y2kCoin-Website/refs/heads/main/IMG_7357.jpeg" alt="Obsidian"/></a>
  </div>
  <div>
    <button id="connectBtn">Connect Wallet</button>
    <div id="walletStatus">Not connected</div>
  </div>
</header>

<!-- Hero Banner -->
<section style="text-align:center;margin-top:1rem;" class="section">
  <img src="https://raw.githubusercontent.com/LandoCrissian/Y2kCoin-Website/refs/heads/main/IMG_7318.png" alt="Y2K Banner" style="max-width:100%;border-radius:10px;box-shadow:0 0 20px var(--accent);"/>
</section>

<div class="container">
  <!-- Submissions -->
  <div class="section">
    <h2>üì° Live Submissions</h2>
    <div id="liveSubmissions"></div>
  </div>

  <!-- Certified: Swipeable Vault -->
  <div class="section">
    <h2 style="text-align:center;">‚úÖ Certified Tracks</h2>
    <div id="trackVault" style="position:relative;overflow:hidden;">
      <div id="trackSwiper" style="display:flex;transition:transform 0.6s ease-in-out;"></div>
      <button id="prevTrack" style="position:absolute;left:0;top:50%;transform:translateY(-50%);z-index:10;font-size:1.5rem;">‚¨ÖÔ∏è</button>
      <button id="nextTrack" style="position:absolute;right:0;top:50%;transform:translateY(-50%);z-index:10;font-size:1.5rem;">‚û°Ô∏è</button>
    </div>
  </div>

  <!-- Submit -->
  <div class="section">
    <h2>üé∂ Submit a Track</h2>
    <form id="submissionForm" onsubmit="submitTrack(event)">
      <input required placeholder="Track Title" id="trackName"/>
      <input required placeholder="Your X / Twitter @handle" id="handle"/>
      <select id="vibe"><option disabled selected>Select Vibe</option><option>Glitch</option><option>Dub</option><option>Trap</option><option>Other</option></select>
      <textarea id="notes" placeholder="Optional notes..."></textarea>
      <button class="btn" type="submit">Submit Track (30 CRO)</button>
    </form>
  </div>

  <!-- Admin Panel -->
  <div id="adminPanel" class="section">
    <h2>üõ†Ô∏è Admin Panel</h2>

    <!-- Fast Upload (Admin Shortcut) -->
    <div class="card">
      <h3>üöÄ Fast Upload to Certified</h3>
      <input id="certTrackName" placeholder="Track Title" />
      <input id="certHandle" placeholder="Twitter @handle" />
      <select id="certVibe">
        <option disabled selected>Select Vibe</option>
        <option>Glitch</option><option>Dub</option><option>Trap</option><option>Other</option>
      </select>
      <input id="certAudio" placeholder="IPFS Audio URL (e.g. Qm...)" />
      <input id="certImage" placeholder="IPFS Cover Image URL (e.g. Qm...)" />
      <button class="btn" onclick="fastUploadTrack()">Upload Track to Certified</button>
    </div>

    <!-- Manual Certify Flow -->
    <div class="card" style="margin-top:2rem;">
      <h3>üì• Certify User Submission</h3>
      <input id="adminStampId" placeholder="Submission ID (from below)" />
      <input id="ipfsAudio" placeholder="IPFS Audio URL (e.g. Qm...)" />
      <input id="ipfsImage" placeholder="IPFS Cover Image URL (e.g. Qm...)" />
      <button class="btn" onclick="certifyTrack()">Certify Submission</button>
    </div>
  </div>

  <!-- FAQ -->
  <div class="section">
    <h2>‚ùì FAQ</h2>
    <details><summary>How do I submit?</summary><p>Connect wallet, fill details, send 30 CRO. Admin reviews and certifies.</p></details>
    <details><summary>What happens after certification?</summary><p>Your track moves to Certified with art + audio preview.</p></details>
    <details><summary>Where are files stored?</summary><p>All files are hosted via IPFS (Pinata).</p></details>
  </div>
</div>

<!-- Footer -->
<footer>
  <img src="https://raw.githubusercontent.com/LandoCrissian/Y2kCoin-Website/refs/heads/main/AC6583AD-EE37-486D-8220-6555D24B0D9D.png" alt="Y2K Logo"/>
  <p>&copy; 2025 Y2K | Roast Records</p>
  <div>
    <a href="https://x.com/y2kc0in?s=21" target="_blank">ùïè</a>|
    <a href="https://discord.gg/jpFbSapSAh" target="_blank">Discord</a>|
    <a href="https://obsidian.finance/?outputCurrency=0xB4Df7d2A736Cc391146bB0dF4277E8F68247Ac6d" target="_blank">Buy</a>
  </div>
</footer>

<div id="toast-container"></div>

<!-- Web3 + Firebase -->
<script src="https://cdn.jsdelivr.net/npm/ethers@5.7.2/dist/ethers.umd.min.js"></script>
<script src="https://www.gstatic.com/firebasejs/10.12.3/firebase-app-compat.js"></script>
<script src="https://www.gstatic.com/firebasejs/10.12.3/firebase-firestore-compat.js"></script>
<script>
const treasuryWallet="0x99FD6Daaa57ebE7f10Ee94E6c1b7522Fa2b0d100";
const adminWallet="0x7fc2ab08f46c10489bab5d694d574022f1048198";
let currentAccount = null;
let hasSigned = false;

const firebaseConfig={apiKey:"AIzaSyByE3Z0Ui_aFr1JUgVzw3ZDatGv8DzqVcE",authDomain:"y2kroastrecords.firebaseapp.com",projectId:"y2kroastrecords",storageBucket:"y2kroastrecords.appspot.com",messagingSenderId:"313829428782",appId:"1:313829428782:web:4e42771ba525f6f297d9bf"};
firebase.initializeApp(firebaseConfig);
const db=firebase.firestore();

function showToast(msg){
  const container=document.getElementById("toast-container");
  const toast=document.createElement("div");
  toast.className="toast"; toast.innerText=msg;
  container.appendChild(toast);
  setTimeout(()=>toast.classList.add("show"),50);
  setTimeout(()=>{toast.classList.remove("show"); setTimeout(()=>toast.remove(),300);},4000);
}

async function connectWallet() {
  if (!window.ethereum) return alert("No wallet found");
  try {
    const provider = new ethers.providers.Web3Provider(window.ethereum);
    await provider.send("eth_requestAccounts", []);
    const signer = provider.getSigner();
    const address = await signer.getAddress();

    if (!hasSigned) {
      await signer.signMessage("Sign to access Y2K Roast Records");
      hasSigned = true;
    }

    currentAccount = address.toLowerCase();
    walletStatus.innerText = `${currentAccount.slice(0,6)}...${currentAccount.slice(-4)}`;
    connectBtn.innerText = "Disconnect";
    connectBtn.classList.add("disconnect");
    showToast("Wallet connected");

    if (currentAccount === adminWallet) {
      gsap.to("#adminPanel",{autoAlpha:1,y:0,duration:0.6});
    }
  } catch (err) {
    console.error(err);
    showToast("Wallet connection failed");
  }
}

function disconnectWallet() {
  currentAccount = null;
  hasSigned = false;
  walletStatus.innerText = "Not connected";
  connectBtn.innerText = "Connect Wallet";
  connectBtn.classList.remove("disconnect");
  gsap.to("#adminPanel",{autoAlpha:0,duration:0.4});
  showToast("Wallet disconnected");
}

connectBtn.addEventListener("click",()=>{
  if(currentAccount){disconnectWallet();}else{connectWallet();}
});

async function submitTrack(e){
  e.preventDefault();
  if(!currentAccount) return alert("Connect wallet");
  const provider=new ethers.providers.Web3Provider(window.ethereum);
  const signer=provider.getSigner();
  const tx=await signer.sendTransaction({to:treasuryWallet,value:ethers.utils.parseEther("30")});
  await tx.wait();
  const doc={track:trackName.value,handle:handle.value,vibe:vibe.value,notes:notes.value,wallet:currentAccount,timestamp:Date.now()};
  await db.collection("submissions").add(doc);
  showToast("Track submitted!");
  submissionForm.reset();
  loadSubmissions();
}

async function certifyTrack(){
  const id=adminStampId.value.trim(),audio=ipfsAudio.value.trim(),image=ipfsImage.value.trim();
  const ref=db.collection("submissions").doc(id),snap=await ref.get();
  if(!snap.exists) return alert("No submission found");
  const data=snap.data();
  await db.collection("certified").add({...data,audio,image,certifiedAt:Date.now()});
  await ref.delete();
  showToast("Certified!");
  loadCertified(); loadSubmissions();
}

async function fastUploadTrack(){
  const track = certTrackName.value.trim(), handle = certHandle.value.trim(), vibe = certVibe.value,
        audio = certAudio.value.trim(), image = certImage.value.trim();

  if (!track || !handle || !audio || !image || !vibe) return showToast("Fill out all fields");

  const doc = { track, handle, vibe, audio, image, wallet: adminWallet, certifiedAt: Date.now() };
  await db.collection("certified").add(doc);
  showToast("Track uploaded to Certified!");
  certTrackName.value = certHandle.value = certAudio.value = certImage.value = "";
  certVibe.selectedIndex = 0;
  loadCertified();
}

async function loadSubmissions(){
  const subs=await db.collection("submissions").orderBy("timestamp","desc").get();
  liveSubmissions.innerHTML="";
  subs.forEach(doc=>{
    const d=doc.data();
    liveSubmissions.innerHTML+=`<div class="card"><b>${d.track}</b><br/><i>@${d.handle}</i><br/><small>${d.wallet.slice(0,6)}...${d.wallet.slice(-4)}</small><br/><small>${d.vibe}</small><br/><small>ID: <code>${doc.id}</code></small></div>`;
  });
}

async function loadCertified() {
  const certs = await db.collection("certified").orderBy("certifiedAt", "desc").get();
  const swiper = document.getElementById("trackSwiper");
  swiper.innerHTML = "";

  certs.forEach((doc) => {
    const d = doc.data();
    const card = document.createElement("div");
    card.className = "card";
    card.style = "min-width:100%;flex-shrink:0;display:flex;flex-direction:column;align-items:center;justify-content:center;text-align:center;padding:1rem;box-sizing:border-box;";
    card.innerHTML = `
      <b style="font-size:1.2rem;">${d.track} <span style="color:var(--verified)">[Certified]</span></b>
      <br/><i>@${d.handle}</i>
      <img src="https://ipfs.io/ipfs/${d.image}" alt="Cover" style="margin:0.5rem 0;width:80%;max-width:300px;border-radius:8px;"/>
      <audio controls style="width:90%;max-width:300px;border-radius:8px;" src="https://ipfs.io/ipfs/${d.audio}"></audio>
    `;
    swiper.appendChild(card);
  });

  initSwiper();
}

loadSubmissions(); loadCertified();

// Carousel Functions
let swipeInterval;
const autoSwipeDelay = 10000; // 10 seconds
let currentIndex = 0;

// Carousel Functionality
const resetAutoplay = () => {
  clearInterval(swipeInterval);
  swipeInterval = setInterval(() => {
    goToNextTrack();
  }, autoSwipeDelay);
};

const goToNextTrack = () => {
  currentIndex = (currentIndex + 1) % document.querySelectorAll('audio').length;
  updateTrackDisplay();
};

const goToPrevTrack = () => {
  currentIndex = (currentIndex - 1 + document.querySelectorAll('audio').length) % document.querySelectorAll('audio').length;
  updateTrackDisplay();
};

const updateTrackDisplay = () => {
  const track = document.querySelector('#trackSwiper');
  const cards = track.children;
  for (let i = 0; i < cards.length; i++) {
    cards[i].style.display = (i === currentIndex) ? 'flex' : 'none';
  }
};

// Event Listeners
document.getElementById('nextTrack').addEventListener('click', () => {
  goToNextTrack();
  resetAutoplay();
});
document.getElementById('prevTrack').addEventListener('click', () => {
  goToPrevTrack();
  resetAutoplay();
});

// Background Canvas Animation
const canvas = document.getElementById("bgCanvas");
const ctx = canvas.getContext("2d");
let w, h;
function resize() {
  w = canvas.width = window.innerWidth;
  h = canvas.height = window.innerHeight;
}
window.addEventListener("resize", resize);
resize();

let t = 0;
function draw() {
  ctx.fillStyle = "rgba(11,13,18,0.6)";
  ctx.fillRect(0, 0, w, h);
  ctx.strokeStyle = "rgba(0,255,195,0.4)";
  for (let i = 0; i < 30; i++) {
    ctx.beginPath();
    ctx.moveTo(0, h / 2 + i * 20 + Math.sin(t / 20 + i) * 10);
    ctx.lineTo(w, h / 2 + i * 20 + Math.sin(t / 20 + i) * 10);
    ctx.stroke();
  }
  ctx.strokeStyle = "rgba(255,0,170,0.4)";
  ctx.beginPath();
  for (let x = 0; x < w; x += 10) {
    ctx.lineTo(x, h / 2 + Math.sin((x + t) / 40) * 60);
  }
  ctx.stroke();
  t += 2;
  requestAnimationFrame(draw);
}
draw();

// GSAP Scroll Reveal
gsap.utils.toArray('.section').forEach((sec) => {
  gsap.to(sec, {
    scrollTrigger: { trigger: sec, start: "top 80%" },
    opacity: 1,
    y: 0,
    duration: 1.2,
    ease: "power2.out"
  });
});
</script>
</body>
</html>
