<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=0"/>
  <title>Y2K x ROAST | Dual Chain Chaos</title>
  <meta name="description" content="The Y2K x ROAST fusion hub. Explore NFTs, burn mechanics, and trading portals across Cronos and Solana."/>
  <link href="https://fonts.googleapis.com/css2?family=Orbitron:wght@600&family=Rubik:wght@400;700&display=swap" rel="stylesheet">
  <script src="https://cdn.tailwindcss.com"></script>
  <script src="https://cdn.jsdelivr.net/npm/ethers@5.7.2/dist/ethers.umd.min.js"></script>
</head>
<body class="bg-black text-white">

<div id="toast" class="fixed top-20 left-1/2 transform -translate-x-1/2 z-50 hidden">
  <div class="bg-gray-900 text-white px-6 py-3 rounded-lg shadow-lg border border-pink-500">
    <span id="toastMessage"></span>
  </div>
</div>

<header class="w-full p-4 bg-[#111] flex justify-between items-center fixed top-0 z-50">
  <h1 class="text-2xl glitch font-bold">Y2K x $ROAST</h1>
  <button id="menuBtn" class="md:hidden">
    <svg class="w-6 h-6" fill="none" stroke="currentColor" viewBox="0 0 24 24">
      <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M4 6h16M4 12h16m-16 6h16"></path>
    </svg>
  </button>
  <nav id="nav" class="hidden md:block md:space-x-4 text-sm absolute md:relative top-16 md:top-0 right-0 bg-[#111] md:bg-transparent w-full md:w-auto p-4 md:p-0">
    <a href="#nfts" class="block md:inline-block py-2 hover:text-[#ff00ff]">Mint</a>
    <a href="#dex" class="block md:inline-block py-2 hover:text-[#ff00ff]">Trade</a>
    <a href="#connect" class="block md:inline-block py-2 hover:text-[#ff00ff]">Connect</a>
    <a href="#submit-roast" class="block md:inline-block py-2 hover:text-[#ff00ff]">Submit</a>
    <a href="#roasted" class="block md:inline-block py-2 hover:text-[#ff00ff]">ROASTED</a>
  </nav>
</header>

<!-- Rest of your sections remain the same until the roast form -->

<section id="submit-roast" class="py-16 px-6 bg-black text-center">
  <h3 class="text-4xl glitch font-bold mb-4">Submit a Roast Target</h3>
  <p class="text-gray-400 max-w-xl mx-auto mb-4">
    Submit a name from ùïè. Pay with CRO. The top roast wins the prize pot.
  </p>

  <div class="text-lg text-pink-400 font-bold mb-6">
    This Week's Pool: <span id="poolCRO">0 CRO</span> + <span id="poolSOL">0 SOL</span>
  </div>

  <div id="walletStatus" class="mb-4 text-sm">
    <span class="px-3 py-1 rounded-full bg-gray-800">Wallet: Not Connected</span>
  </div>

  <form id="roastForm" class="max-w-md mx-auto space-y-4">
    <input type="text" id="targetName" name="target" placeholder="@name or project from ùïè"
           class="w-full p-3 rounded bg-[#1a1a1a] text-white neon-border"/>
    <button type="button" id="submitBtn" onclick="submitWithCRO()"
            class="w-full bg-[#ff00ff] text-black font-bold py-2 rounded hover:bg-pink-600 relative">
      <span id="btnText">Submit with CRO</span>
      <span id="btnLoader" class="hidden absolute left-1/2 top-1/2 transform -translate-x-1/2 -translate-y-1/2">
        <svg class="animate-spin h-5 w-5" xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24">
          <circle class="opacity-25" cx="12" cy="12" r="10" stroke="currentColor" stroke-width="4"></circle>
          <path class="opacity-75" fill="currentColor" d="M4 12a8 8 0 018-8V0C5.373 0 0 5.373 0 12h4zm2 5.291A7.962 7.962 0 014 12H0c0 3.042 1.135 5.824 3 7.938l3-2.647z"></path>
        </svg>
      </span>
    </button>
  </form>

  <div id="roastResult" class="mt-4 text-green-400 text-sm"></div>
  <div id="shareRoast" class="mt-4"></div>
</section>

<!-- Rest of your sections remain the same -->

<style>
  html { background-color: #0a0a0a; }
  body {
    background-color: #0a0a0a;
    font-family: 'Rubik', sans-serif;
    color: #e2e8f0;
    overflow-x: hidden;
  }
  .glitch {
    text-shadow: 2px 0 red, -2px 0 cyan;
    font-family: 'Orbitron', sans-serif;
    animation: glitch 2s infinite;
  }
  @keyframes glitch {
    2%, 64% { transform: translate(2px,0) skew(0deg); }
    4%, 60% { transform: translate(-2px,0) skew(0deg); }
    62% { transform: translate(0,0) skew(5deg); }
  }
  .neon-border {
    border: 2px solid #ff00ff;
    box-shadow: 0 0 10px #ff00ff;
    transition: all 0.3s ease;
  }
  .neon-border:active {
    transform: scale(0.95);
    box-shadow: 0 0 5px #ff00ff;
  }
  .glow {
    box-shadow: 0 0 20px #ff0077;
    transition: all 0.3s ease;
  }
  .glow:active {
    transform: scale(0.95);
    box-shadow: 0 0 10px #ff0077;
  }
  #nfts img {
    width: 192px;
    height: 192px;
    object-fit: cover;
    display: block;
  }
  
  @keyframes slideIn {
    from { transform: translateY(-100%); opacity: 0; }
    to { transform: translateY(0); opacity: 1; }
  }
  
  #toast.show {
    display: block;
    animation: slideIn 0.3s ease-out;
  }
</style>

<script>
  // Mobile menu toggle
  document.getElementById('menuBtn').addEventListener('click', () => {
    const nav = document.getElementById('nav');
    nav.classList.toggle('hidden');
  });

  // Toast notification system
  function showToast(message, duration = 3000) {
    const toast = document.getElementById('toast');
    const toastMessage = document.getElementById('toastMessage');
    toastMessage.textContent = message;
    toast.classList.add('show');
    toast.classList.remove('hidden');
    
    setTimeout(() => {
      toast.classList.remove('show');
      toast.classList.add('hidden');
    }, duration);
  }

  // Wallet connection check
  async function checkWalletConnection() {
    const walletStatus = document.getElementById('walletStatus');
    
    if (typeof window.ethereum === "undefined") {
      walletStatus.innerHTML = '<span class="px-3 py-1 rounded-full bg-red-900">No Wallet Detected</span>';
      return false;
    }

    try {
      const accounts = await window.ethereum.request({ method: 'eth_accounts' });
      if (accounts.length > 0) {
        const shortenedAccount = accounts[0].slice(0, 6) + '...' + accounts[0].slice(-4);
        walletStatus.innerHTML = `<span class="px-3 py-1 rounded-full bg-green-900">Connected: ${shortenedAccount}</span>`;
        return true;
      } else {
        walletStatus.innerHTML = '<span class="px-3 py-1 rounded-full bg-yellow-900">Wallet Not Connected</span>';
        return false;
      }
    } catch (err) {
      console.error('Error checking wallet connection:', err);
      walletStatus.innerHTML = '<span class="px-3 py-1 rounded-full bg-red-900">Connection Error</span>';
      return false;
    }
  }

  // Check wallet connection on page load
  window.addEventListener('load', checkWalletConnection);

  // Handle chain switching
  async function switchToCronosChain() {
    try {
      await window.ethereum.request({
        method: 'wallet_switchEthereumChain',
        params: [{ chainId: '0x19' }],
      });
      return true;
    } catch (error) {
      if (error.code === 4902) {
        try {
          await window.ethereum.request({
            method: 'wallet_addEthereumChain',
            params: [{
              chainId: '0x19',
              chainName: 'Cronos Mainnet',
              nativeCurrency: {
                name: 'CRO',
                symbol: 'CRO',
                decimals: 18
              },
              rpcUrls: ['https://evm.cronos.org'],
              blockExplorerUrls: ['https://cronoscan.com/']
            }]
          });
          return true;
        } catch (addError) {
          showToast('Failed to add Cronos network');
          return false;
        }
      }
      showToast('Failed to switch to Cronos network');
      return false;
    }
  }

  async function submitWithCRO() {
    const submitBtn = document.getElementById('submitBtn');
    const btnText = document.getElementById('btnText');
    const btnLoader = document.getElementById('btnLoader');
    const target = document.getElementById('targetName').value.trim();
    const resultBox = document.getElementById('roastResult');
    const shareBox = document.getElementById('shareRoast');

    // Input validation
    if (!target || target.length < 3 || !target.startsWith('@')) {
      showToast('Enter a valid ùïè username or project (start with @)');
      return;
    }

    // Wallet detection
    if (typeof window.ethereum === 'undefined') {
      showToast('MetaMask not detected');
      return;
    }

    // Show loading state
    btnText.classList.add('invisible');
    btnLoader.classList.remove('hidden');
    submitBtn.disabled = true;

    try {
      // Request account access
      const accounts = await window.ethereum.request({ method: 'eth_requestAccounts' });
      if (!accounts || accounts.length === 0) {
        throw new Error('No accounts found');
      }

      // Switch to Cronos chain
      if (!await switchToCronosChain()) {
        throw new Error('Failed to switch to Cronos network');
      }

      // Setup provider and signer
      const provider = new ethers.providers.Web3Provider(window.ethereum);
      const signer = provider.getSigner();

      // Send transaction
      const tx = await signer.sendTransaction({
        to: '0x99FD6Daaa57ebE7f10Ee94E6c1b7522Fa2b0d100',
        value: ethers.utils.parseUnits('60', 'ether'),
        gasLimit: 100000, // Explicitly set gas limit
      });

      // Wait for transaction confirmation
      const receipt = await tx.wait();

      // Handle successful transaction
      showToast('Roast submitted successfully!');
      resultBox.innerHTML = `
        <div class="p-4 bg-green-900 rounded-lg">
          <p>Roast for "${target}" submitted via CRO.</p>
          <a href="https://cronoscan.com/tx/${tx.hash}" target="_blank" 
             class="text-blue-400 hover:text-blue-300 underline">
            View Transaction
          </a>
        </div>
      `;

      // Update local storage
      const roasts = JSON.parse(localStorage.getItem('roasts')) || [];
      roasts.unshift({ target, chain: 'Cronos', likes: 0, tx: tx.hash });
      localStorage.setItem('roasts', JSON.stringify(roasts));

      // Setup share button
      const tweetText = encodeURIComponent(
        `I just submitted ${target} to be roasted using $Y2KCoin on CRO.\nWeb3 verified. Vote or die.`
      );
      const tweetURL = `https://x.com/intent/tweet?text=${tweetText}&hashtags=Y2KRoast,CROFam`;
      shareBox.innerHTML = `
        <a href="${tweetURL}" target="_blank" 
           class="inline-block mt-4 px-4 py-2 bg-[#ff00ff] text-black font-bold rounded hover:bg-pink-600">
          Share on ùïè
        </a>
      `;

    } catch (err) {
      console.error('Transaction failed:', err);
      showToast(err.message || 'Transaction failed. Check console.');
      resultBox.innerHTML = `
        <div class="p-4 bg-red-900 rounded-lg">
          ${err.message || 'Transaction failed. Please try again.'}
        </div>
      `;
    } finally {
      // Reset button state
      btnText.classList.remove('invisible');
      btnLoader.classList.add('hidden');
      submitBtn.disabled = false;
    }
  }

  // Update wallet status when accounts change
  if (window.ethereum) {
    window.ethereum.on('accountsChanged', checkWalletConnection);
    window.ethereum.on('chainChanged', checkWalletConnection);
  }
</script>
</body>
</html>
