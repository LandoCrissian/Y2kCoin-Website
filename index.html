<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Y2KCoin - A Digital Revolution</title>
    <meta name="description" content="Y2KCoin is a community-driven cryptocurrency blending nostalgia with blockchain innovation.">
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://unpkg.com/ethers@5.7.2/dist/ethers.umd.min.js"></script>
    <link href="https://fonts.googleapis.com/css2?family=Orbitron:wght@400;700&display=swap" rel="stylesheet">
    <style>
        /* Base Styles */
        body {
            font-family: 'Orbitron', sans-serif;
            background-color: #0a0a0a;
            color: #e2e8f0;
        }
        .glow-text { 
            text-shadow: 0px 0px 8px cyan; 
        }

        /* Button Styles */
        .btn {
            padding: 10px 20px;
            border-radius: 8px;
            font-size: 1.1rem;
            font-weight: bold;
            transition: all 0.3s ease-in-out;
            position: relative;
            overflow: hidden;
        }
        .btn::after {
            content: '';
            position: absolute;
            top: -50%;
            left: -50%;
            width: 200%;
            height: 200%;
            background: linear-gradient(
                to bottom right,
                rgba(255, 255, 255, 0.2) 0%,
                rgba(255, 255, 255, 0.05) 40%,
                rgba(255, 255, 255, 0) 100%
            );
            transform: rotate(45deg);
            transition: all 0.3s ease-in-out;
        }
        .btn:hover::after {
            transform: rotate(45deg) translate(50%, 50%);
        }
        .btn:disabled {
            opacity: 0.5;
            cursor: not-allowed;
            transform: none !important;
        }
        .btn-primary { 
            background-color: #00e6e6; 
            color: #0a0a0a; 
            box-shadow: 0 0 20px rgba(0, 230, 230, 0.3);
        }
        .btn-primary:hover:not(:disabled) { 
            background-color: #009999; 
            transform: translateY(-2px);
            box-shadow: 0 0 30px rgba(0, 230, 230, 0.5);
        }
        .btn-secondary { 
            background-color: #ff007f; 
            color: #fff; 
            box-shadow: 0 0 20px rgba(255, 0, 127, 0.3);
        }
        .btn-secondary:hover:not(:disabled) { 
            background-color: #cc0066; 
            transform: translateY(-2px);
            box-shadow: 0 0 30px rgba(255, 0, 127, 0.5);
        }

        /* Staking Interface Styles */
        .staking-card {
            background: rgba(17, 17, 17, 0.95);
            border: 1px solid #00e6e6;
            border-radius: 16px;
            padding: 24px;
            margin: 12px 0;
            backdrop-filter: blur(10px);
            transition: all 0.3s ease;
        }
        .staking-card:hover {
            transform: translateY(-2px);
            box-shadow: 0 0 30px rgba(0, 230, 230, 0.1);
        }
        .staking-input {
            background: rgba(26, 26, 26, 0.9);
            border: 2px solid #333;
            color: white;
            padding: 12px 16px;
            border-radius: 12px;
            width: 100%;
            transition: all 0.3s ease;
            margin-bottom: 1rem;
            font-family: 'Courier New', monospace;
        }
        .staking-input:focus {
            border-color: #00e6e6;
            outline: none;
            box-shadow: 0 0 20px rgba(0, 230, 230, 0.2);
            transform: translateY(-1px);
        }
        .balance-display {
            font-family: 'Courier New', monospace;
            font-size: 1.2rem;
            color: #00e6e6;
            background: rgba(0, 230, 230, 0.1);
            padding: 8px 16px;
            border-radius: 8px;
            margin: 8px 0;
        }

        /* Keep your existing styles for tabs, notifications, etc. */
        .tab-content {
            display: none;
            opacity: 0;
            transform: translateY(20px);
            transition: all 0.3s ease-in-out;
        }
        .tab-content.active {
            display: block;
            opacity: 1;
            transform: translateY(0);
        }
        
        /* ... (keep all your other existing styles) ... */
    </style>
</head>
<body class="flex flex-col items-center text-center px-4 min-h-screen">
    <!-- Loading Overlay -->
    <div id="loading-overlay" class="fixed inset-0 bg-black bg-opacity-80 z-50 hidden flex items-center justify-center backdrop-blur-sm">
        <div class="text-center">
            <div class="spinner mx-auto mb-4"></div>
            <p class="text-cyan-400" id="loading-text">Connecting to network...</p>
        </div>
    </div>

    <!-- Header -->
    <header class="w-full py-4 bg-[#0a0a0a] fixed top-0 z-40 backdrop-blur-md bg-opacity-80">
        <nav class="flex justify-between items-center max-w-5xl mx-auto px-4">
            <img src="https://raw.githubusercontent.com/LandoCrissian/Y2kCoin-Website/refs/heads/main/52A313DE-90B7-4BFF-A5FD-DDC368B31A0F.jpeg" 
                 alt="Y2KCoin Logo" 
                 class="w-16 hover:scale-105 transition-transform duration-300">
            <ul class="flex flex-wrap justify-center gap-4">
                <li><button class="tab-btn active" data-tab="about">About</button></li>
                <li><button class="tab-btn" data-tab="mission">Mission</button></li>
                <li><button class="tab-btn" data-tab="marketplace">Marketplace</button></li>
                <li><button class="tab-btn" data-tab="nfts">NFTs</button></li>
                <li><button class="tab-btn" data-tab="staking">Staking</button></li>
                <li><button class="tab-btn" data-tab="gaming">Gaming</button></li>
            </ul>
        </nav>
    </header>

    <!-- Main Content -->
    <main class="w-full max-w-4xl py-20 flex-grow mt-16">
        <!-- Keep your existing hero section -->
        <section id="hero" class="mb-10">
            <!-- Your existing hero content -->
        </section>

        <!-- Tab Content -->
        <section id="tab-content" class="mt-8">
            <!-- Keep your existing About, Mission, Marketplace, and NFTs tabs -->

            <!-- Updated Staking Tab -->
            <div id="staking" class="tab-content">
                <h2 class="text-3xl font-bold glow-text mb-6">Y2K Staking Dashboard</h2>
                
                <!-- Wallet Connection Section -->
                <div id="wallet-section" class="mb-8">
                    <button id="connect-wallet" class="btn btn-primary">
                        <span class="relative z-10">Connect Wallet</span>
                    </button>
                    <button id="disconnect-wallet" class="btn btn-secondary hidden">
                        <span class="relative z-10">Disconnect Wallet</span>
                    </button>
                    <div id="network-info" class="mt-4 hidden">
                        <p class="text-lg">Connected Wallet: <span id="wallet-address" class="font-mono text-cyan-400"></span></p>
                        <p class="text-lg">Network: <span id="network-name" class="text-cyan-400">Not Connected</span></p>
                    </div>
                </div>

                <!-- Improved Staking Interface -->
                <div id="staking-interface" class="hidden opacity-0 transform translate-y-4 transition-all duration-300">
                    <div class="grid grid-cols-1 md:grid-cols-2 gap-6">
                        <!-- Balances Card -->
                        <div class="staking-card">
                            <h3 class="text-xl font-bold text-cyan-400 mb-6">Your Balances</h3>
                            <div class="space-y-4">
                                <div>
                                    <p class="text-gray-400 mb-2">Available Y2K</p>
                                    <div id="available-amount" class="balance-display">0.00 Y2K</div>
                                </div>
                                <div>
                                    <p class="text-gray-400 mb-2">Staked Y2K</p>
                                    <div id="staked-amount" class="balance-display">0.00 Y2K</div>
                                </div>
                                <div>
                                    <p class="text-gray-400 mb-2">Pending Rewards</p>
                                    <div id="pending-rewards" class="balance-display">0.00 POGs</div>
                                </div>
                            </div>
                        </div>

                        <!-- Staking Actions Card -->
                        <div class="staking-card">
                            <h3 class="text-xl font-bold text-cyan-400 mb-6">Staking Actions</h3>
                            <div class="space-y-4">
                                <div>
                                    <input type="number" 
                                           id="stake-amount" 
                                           class="staking-input" 
                                           placeholder="Enter amount (min 100 Y2K)"
                                           min="100"
                                           step="1">
                                    <input type="text" 
                                           id="referral-address" 
                                           class="staking-input" 
                                           placeholder="Referral Address (Optional)">
                                </div>
                                <div class="flex gap-2">
                                    <button id="approve-btn" class="btn btn-primary flex-1">
                                        <span class="relative z-10">Approve</span>
                                    </button>
                                    <button id="stake-btn" class="btn btn-primary flex-1" disabled>
                                        <span class="relative z-10">Stake</span>
                                    </button>
                                </div>
                                <button id="unstake-btn" class="btn btn-secondary w-full" disabled>
                                    <span class="relative z-10">Unstake</span>
                                </button>
                            </div>
                        </div>
                    </div>

                    <!-- Rewards Card -->
                    <div class="staking-card mt-6">
                        <h3 class="text-xl font-bold text-cyan-400 mb-4">Rewards</h3>
                        <button id="claim-btn" class="btn btn-primary" disabled>
                            <span class="relative z-10">Claim Rewards</span>
                        </button>
                    </div>
                </div>
            </div>

            <!-- Keep your existing Gaming tab -->
        </section>
    </main>

    <!-- Keep your existing footer -->
    <footer class="w-full py-6 bg-[#0a0a0a] mt-auto">
        <!-- Your existing footer content -->
    </footer>

    <!-- Notification Container -->
    <div id="notification-container" class="fixed bottom-4 right-4 z-50"></div>

    <!-- Transaction Status Modal -->
    <div id="transaction-modal" class="modal">
        <div class="modal-content">
            <h3 class="text-xl font-bold text-cyan-400 mb-4">Transaction Status</h3>
            <div class="progress-bar mb-4">
                <div class="progress-bar-fill" style="width: 0%"></div>
            </div>
            <p id="transaction-status" class="text-gray-400"></p>
        </div>
    </div>
    <script>
// Contract Configuration
const Y2K_TOKEN_ADDRESS = "0xB4Df7d2A736Cc391146bB0dF4277E8F68247Ac6d";
const CONTRACT_ADDRESS = "0x7DC6a9900e9DE69fF36ECb7dF56aA7c9157DE483";
const CRONOS_CHAIN_ID = '0x19';
const CRONOS_NETWORK_CONFIG = {
    chainId: CRONOS_CHAIN_ID,
    chainName: 'Cronos Mainnet',
    nativeCurrency: {
        name: 'CRO',
        symbol: 'CRO',
        decimals: 18
    },
    rpcUrls: ['https://evm.cronos.org'],
    blockExplorerUrls: ['https://cronoscan.com/']
};

// Token ABI
const Y2K_TOKEN_ABI = [
    "function approve(address spender, uint256 amount) external returns (bool)",
    "function allowance(address owner, address spender) external view returns (uint256)",
    "function balanceOf(address account) external view returns (uint256)",
    "function transfer(address to, uint256 amount) external returns (bool)",
    "function transferFrom(address from, address to, uint256 amount) external returns (bool)"
];

// Contract ABI
const CONTRACT_ABI = [
    {
        "inputs": [
            {"internalType": "uint256", "name": "_amount", "type": "uint256"},
            {"internalType": "address", "name": "_referrer", "type": "address"}
        ],
        "name": "stake",
        "outputs": [],
        "stateMutability": "nonpayable",
        "type": "function"
    },
    {
        "inputs": [{"internalType": "uint256", "name": "_amount", "type": "uint256"}],
        "name": "unstake",
        "outputs": [],
        "stateMutability": "nonpayable",
        "type": "function"
    },
    {
        "inputs": [],
        "name": "claimReward",
        "outputs": [],
        "stateMutability": "nonpayable",
        "type": "function"
    },
    {
        "inputs": [{"internalType": "address", "name": "", "type": "address"}],
        "name": "stakes",
        "outputs": [
            {"internalType": "uint256", "name": "amount", "type": "uint256"},
            {"internalType": "uint256", "name": "startTime", "type": "uint256"},
            {"internalType": "uint256", "name": "lastCompoundTime", "type": "uint256"}
        ],
        "stateMutability": "view",
        "type": "function"
    },
    {
        "inputs": [],
        "name": "y2kToken",
        "outputs": [{"internalType": "contract IERC20", "name": "", "type": "address"}],
        "stateMutability": "view",
        "type": "function"
    }
];

// Global Variables
let provider, signer, contract, y2kTokenContract;
let isWalletConnected = false;

// UI Manager
class UIManager {
    static showLoading(message = 'Processing...') {
        const overlay = document.getElementById('loading-overlay');
        const loadingText = document.getElementById('loading-text');
        loadingText.textContent = message;
        overlay.classList.remove('hidden');
        overlay.style.display = 'flex';
    }

    static hideLoading() {
        const overlay = document.getElementById('loading-overlay');
        overlay.classList.add('hidden');
        overlay.style.display = 'none';
    }

    static showNotification(message, type = 'info') {
        const container = document.getElementById('notification-container');
        const notification = document.createElement('div');
        notification.className = `notification ${type} transform transition-all duration-300`;
        notification.innerHTML = `
            <div class="flex items-center justify-between">
                <span>${message}</span>
                <button onclick="this.parentElement.parentElement.remove()" class="ml-4">×</button>
            </div>
        `;
        container.appendChild(notification);
        
        setTimeout(() => notification.classList.add('show'), 100);
        setTimeout(() => {
            notification.classList.remove('show');
            setTimeout(() => notification.remove(), 300);
        }, 5000);
    }

    static async updateBalances(address) {
        try {
            const balance = await y2kTokenContract.balanceOf(address);
            const stakeInfo = await contract.stakes(address);
            
            document.getElementById('available-amount').textContent = 
                `${ethers.utils.formatEther(balance)} Y2K`;
            document.getElementById('staked-amount').textContent = 
                `${ethers.utils.formatEther(stakeInfo.amount)} Y2K`;
            
            // Update button states
            document.getElementById('stake-btn').disabled = balance.isZero();
            document.getElementById('unstake-btn').disabled = stakeInfo.amount.isZero();
            document.getElementById('claim-btn').disabled = stakeInfo.amount.isZero();
        } catch (error) {
            console.error('Error updating balances:', error);
        }
    }

    static async updateStakingInterface(address) {
        const stakingInterface = document.getElementById('staking-interface');
        stakingInterface.classList.remove('hidden');
        
        try {
            await this.updateBalances(address);
            
            setTimeout(() => {
                stakingInterface.style.opacity = '1';
                stakingInterface.style.transform = 'translateY(0)';
            }, 100);

            // Setup event listeners
            this.setupStakingEventListeners();
        } catch (error) {
            console.error('Error updating interface:', error);
            this.showNotification('Error loading staking interface', 'error');
        }
    }

    static setupStakingEventListeners() {
        document.getElementById('approve-btn')?.addEventListener('click', approveTokens);
        document.getElementById('stake-btn')?.addEventListener('click', stake);
        document.getElementById('unstake-btn')?.addEventListener('click', unstake);
        document.getElementById('claim-btn')?.addEventListener('click', claimRewards);
    }
}

// Network Manager
class NetworkManager {
    static async checkAndSwitchNetwork() {
        if (!window.ethereum) throw new Error('MetaMask is not installed');

        const chainId = await window.ethereum.request({ method: 'eth_chainId' });
        if (chainId !== CRONOS_CHAIN_ID) {
            try {
                await window.ethereum.request({
                    method: 'wallet_switchEthereumChain',
                    params: [{ chainId: CRONOS_CHAIN_ID }],
                });
            } catch (error) {
                if (error.code === 4902) {
                    try {
                        await window.ethereum.request({
                            method: 'wallet_addEthereumChain',
                            params: [CRONOS_NETWORK_CONFIG],
                        });
                    } catch (addError) {
                        throw new Error('Failed to add Cronos network');
                    }
                } else {
                    throw error;
                }
            }
        }
    }
}

// Main Functions
async function connectWallet() {
    try {
        UIManager.showLoading('Connecting wallet...');

        if (!window.ethereum) {
            throw new Error('Please install MetaMask');
        }

        await NetworkManager.checkAndSwitchNetwork();

        provider = new ethers.providers.Web3Provider(window.ethereum);
        await provider.send("eth_requestAccounts", []);
        signer = provider.getSigner();
        
        const address = await signer.getAddress();

        // Initialize contracts
        contract = new ethers.Contract(CONTRACT_ADDRESS, CONTRACT_ABI, signer);
        y2kTokenContract = new ethers.Contract(Y2K_TOKEN_ADDRESS, Y2K_TOKEN_ABI, signer);

        // Update UI
        document.getElementById('wallet-address').textContent = 
            `${address.substring(0, 6)}...${address.substring(38)}`;
        document.getElementById('network-name').textContent = 'Cronos Mainnet';
        document.getElementById('network-info').classList.remove('hidden');
        document.getElementById('connect-wallet').classList.add('hidden');
        document.getElementById('disconnect-wallet').classList.remove('hidden');

        await UIManager.updateStakingInterface(address);
        isWalletConnected = true;
        UIManager.showNotification('Wallet connected successfully', 'success');

    } catch (error) {
        console.error('Connection error:', error);
        UIManager.showNotification(error.message, 'error');
    } finally {
        UIManager.hideLoading();
    }
}

async function disconnectWallet() {
    provider = null;
    signer = null;
    contract = null;
    y2kTokenContract = null;
    isWalletConnected = false;

    document.getElementById('network-info').classList.add('hidden');
    document.getElementById('connect-wallet').classList.remove('hidden');
    document.getElementById('disconnect-wallet').classList.add('hidden');
    document.getElementById('staking-interface').classList.add('hidden');

    UIManager.showNotification('Wallet disconnected', 'info');
}

async function approveTokens() {
    if (!isWalletConnected) return;
    
    try {
        const amount = document.getElementById('stake-amount').value;
        if (!amount || amount < 100) {
            throw new Error('Minimum stake amount is 100 Y2K');
        }

        UIManager.showLoading('Approving tokens...');
        const amountWei = ethers.utils.parseEther(amount.toString());
        
        // Approve max amount to save gas on future transactions
        const tx = await y2kTokenContract.approve(
            CONTRACT_ADDRESS, 
            ethers.constants.MaxUint256,
            {
                gasLimit: 100000
            }
        );

        UIManager.showNotification('Approval pending...', 'info');
        await tx.wait();
        
        document.getElementById('stake-btn').disabled = false;
        UIManager.showNotification('Tokens approved successfully', 'success');
    } catch (error) {
        console.error('Approval error:', error);
        UIManager.showNotification(error.reason || error.message, 'error');
    } finally {
        UIManager.hideLoading();
    }
}

async function stake() {
    if (!isWalletConnected) return;
    
    try {
        const amount = document.getElementById('stake-amount').value;
        const referrer = document.getElementById('referral-address').value;
        
        if (!amount || amount < 100) {
            throw new Error('Minimum stake amount is 100 Y2K');
        }

        UIManager.showLoading('Checking allowance...');
        const amountWei = ethers.utils.parseEther(amount.toString());
        
        // Check allowance
        const address = await signer.getAddress();
        const allowance = await y2kTokenContract.allowance(address, CONTRACT_ADDRESS);
        
        if (allowance.lt(amountWei)) {
            throw new Error('Please approve tokens first');
        }

        UIManager.showLoading('Staking tokens...');
        const tx = await contract.stake(
            amountWei,
            referrer || ethers.constants.AddressZero,
            {
                gasLimit: 500000
            }
        );

        UIManager.showNotification('Staking transaction submitted...', 'info');
        await tx.wait();

        await UIManager.updateBalances(address);
        document.getElementById('stake-amount').value = '';
        document.getElementById('referral-address').value = '';
        
        UIManager.showNotification('Tokens staked successfully', 'success');
    } catch (error) {
        console.error('Staking error:', error);
        UIManager.showNotification(error.reason || error.message, 'error');
    } finally {
        UIManager.hideLoading();
    }
}

async function unstake() {
    if (!isWalletConnected) return;
    
    try {
        const amount = document.getElementById('stake-amount').value;
        if (!amount || amount <= 0) {
            throw new Error('Please enter a valid amount to unstake');
        }

        UIManager.showLoading('Unstaking tokens...');
        const amountWei = ethers.utils.parseEther(amount.toString());
        
        const tx = await contract.unstake(amountWei, {
            gasLimit: 300000
        });

        UIManager.showNotification('Unstaking transaction submitted...', 'info');
        await tx.wait();
        
        const address = await signer.getAddress();
        await UIManager.updateBalances(address);
        document.getElementById('stake-amount').value = '';
        
        UIManager.showNotification('Tokens unstaked successfully', 'success');
    } catch (error) {
        console.error('Unstaking error:', error);
        UIManager.showNotification(error.reason || error.message, 'error');
    } finally {
        UIManager.hideLoading();
    }
}

async function claimRewards() {
    if (!isWalletConnected) return;
    
    try {
        UIManager.showLoading('Claiming rewards...');
        
        const tx = await contract.claimReward({
            gasLimit: 300000
        });

        UIManager.showNotification('Claim transaction submitted...', 'info');
        await tx.wait();
        
        const address = await signer.getAddress();
        await UIManager.updateBalances(address);
        
        UIManager.showNotification('Rewards claimed successfully', 'success');
    } catch (error) {
        console.error('Claim error:', error);
        UIManager.showNotification(error.reason || error.message, 'error');
    } finally {
        UIManager.hideLoading();
    }
}

// Event Listeners
document.addEventListener('DOMContentLoaded', () => {
    // Tab switching
    document.querySelectorAll('.tab-btn').forEach(button => {
        button.addEventListener('click', () => {
            const tabId = button.getAttribute('data-tab');
            
            document.querySelectorAll('.tab-btn').forEach(btn => 
                btn.classList.remove('active'));
            button.classList.add('active');
            
            document.querySelectorAll('.tab-content').forEach(content => {
                content.style.display = 'none';
                content.classList.remove('active');
            });
            
            const selectedTab = document.getElementById(tabId);
            selectedTab.style.display = 'block';
            setTimeout(() => selectedTab.classList.add('active'), 50);
        });
    });

    // Wallet connection
    document.getElementById('connect-wallet')?.addEventListener('click', connectWallet);
    document.getElementById('disconnect-wallet')?.addEventListener('click', disconnectWallet);

    // Network changes
    if (window.ethereum) {
        window.ethereum.on('chainChanged', () => window.location.reload());
        window.ethereum.on('accountsChanged', accounts => {
            if (accounts.length === 0) disconnectWallet();
            else window.location.reload();
        });
    }
});
</script>
</body>
</html>
