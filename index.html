<!DOCTYPE html>
<html lang="en" data-theme="dark">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1, viewport-fit=cover" />
  <title>Y2K | Roast Records</title>

  <!-- SEO + Meta -->
  <meta name="description" content="The official site of Y2K | Roast Records â€” glitch-dub-trap music label on Cronos." />
  <meta name="theme-color" content="#0b0d12" />
  <link rel="icon" href="https://raw.githubusercontent.com/LandoCrissian/Y2kCoin-Website/refs/heads/main/AC6583AD-EE37-486D-8220-6555D24B0D9D.pong" />
  <style>
    * { margin: 0; padding: 0; box-sizing: border-box; }
    html, body {
      font-family: 'Inter', sans-serif;
      background: #0b0d12;
      color: white;
      overflow-x: hidden;
      padding: 1rem;
    }
    button, input, select {
      background: #1c1e24;
      color: white;
      border: 1px solid #444;
      padding: 0.5rem;
      border-radius: 4px;
      margin: 0.25rem 0;
    }
    .hidden { display: none; }
    .certified, .pending {
      padding: 0.75rem;
      border-radius: 5px;
      margin-bottom: 1rem;
      background: #12151b;
    }
    .certified { border: 1px solid #39ff14; }
    .pending { border: 1px solid #888; }
    audio { width: 100%; margin-top: 0.5rem; }
    .admin-controls { border-top: 1px solid #333; margin-top: 2rem; padding-top: 1rem; }
  </style>

  <!-- Firebase -->
  <script src="https://cdn.jsdelivr.net/npm/ethers@5.7.2/dist/ethers.umd.min.js"></script>
  <script src="https://www.gstatic.com/firebasejs/10.12.3/firebase-app-compat.js"></script>
  <script src="https://www.gstatic.com/firebasejs/10.12.3/firebase-firestore-compat.js"></script>
  <script src="https://www.gstatic.com/firebasejs/10.12.3/firebase-auth-compat.js"></script>
</head>
<body>

  <h1>ðŸ”¥ Y2K | Roast Records</h1>
  <button id="connectWallet">Connect Wallet</button>
  <p id="walletStatus">Not connected</p>

  <hr>

  <div id="submissionForm" class="hidden">
    <h2>ðŸŽ¤ Submit a Track</h2>
    <input id="projectName" placeholder="Project Name" /><br>
    <input id="twitterHandle" placeholder="Twitter @handle" /><br>
    <select id="vibe">
      <option value="">Select a Vibe</option>
      <option>Glitch</option>
      <option>Dub</option>
      <option>Trap</option>
      <option>Other</option>
    </select><br>
    <textarea id="idea" placeholder="Optional Ideas" rows="4" cols="50"></textarea><br>
    <button id="submitTrack">Submit (30 CRO)</button>
    <p id="submitStatus"></p>
  </div>

  <div id="liveSubmissions">
    <h2>ðŸ“¡ Live Submissions</h2>
    <div id="pendingList"></div>
  </div>

  <div id="certifiedTracks">
    <h2>âœ… Certified Tracks</h2>
    <div id="certifiedList"></div>
  </div>

  <div id="adminPanel" class="admin-controls hidden">
    <h2>ðŸ‘‘ Admin Panel</h2>
    <p>Stamp certified songs from user submissions:</p>
    <div id="adminPendingList"></div>
    <h3>Legacy Upload</h3>
    <input id="legacyName" placeholder="Project Name" /><br>
    <input id="legacyHandle" placeholder="Twitter @handle" /><br>
    <input id="legacyIpfsAudio" placeholder="IPFS Audio Link" /><br>
    <input id="legacyIpfsNft" placeholder="IPFS NFT Cover" /><br>
    <button id="uploadLegacy">Upload</button>
    <p id="legacyStatus"></p>
  </div>

<script>
  const adminWallet = "0x7FC2AB08F46C10489Bab5D694D574022f1048198";

  const firebaseConfig = {
    apiKey: "AIzaSyByE3Z0Ui_aFr1JUgVzw3ZDatGv8DzqVcE",
    authDomain: "y2kroastrecords.firebaseapp.com",
    projectId: "y2kroastrecords",
    storageBucket: "y2kroastrecords.appspot.com",
    messagingSenderId: "313829428782",
    appId: "1:313829428782:web:4e42771ba525f6f297d9bf"
  };
  firebase.initializeApp(firebaseConfig);
  const db = firebase.firestore();

  let userAddress = null;

  async function connectWallet() {
    if (!window.ethereum) return alert("Install MetaMask or Trust Wallet.");
    const provider = new ethers.providers.Web3Provider(window.ethereum);
    await provider.send("eth_requestAccounts", []);
    const signer = provider.getSigner();
    userAddress = await signer.getAddress();
    document.getElementById('walletStatus').innerText = "Connected: " + userAddress;
    document.getElementById('connectWallet').classList.add('hidden');
    document.getElementById('submissionForm').classList.remove('hidden');
    if (userAddress.toLowerCase() === adminWallet.toLowerCase()) {
      document.getElementById('adminPanel').classList.remove('hidden');
    }
  }

  async function submitTrack() {
    const projectName = document.getElementById("projectName").value;
    const twitter = document.getElementById("twitterHandle").value;
    const vibe = document.getElementById("vibe").value;
    const idea = document.getElementById("idea").value;
    if (!projectName || !twitter || !vibe) return alert("Fill required fields.");

    const provider = new ethers.providers.Web3Provider(window.ethereum);
    const signer = provider.getSigner();
    const tx = await signer.sendTransaction({
      to: "0x99FD6Daaa57ebE7f10Ee94E6c1b7522Fa2b0d100",
      value: ethers.utils.parseEther("30")
    });
    await tx.wait();

    await db.collection("submissions").add({
      wallet: userAddress,
      projectName, twitter, vibe, idea,
      timestamp: Date.now(),
      certified: false,
      ipfsAudio: null,
      ipfsNft: null
    });
    document.getElementById("submitStatus").innerText = "âœ… Submitted!";
  }

  async function approveSubmission(docId) {
    const ipfsAudio = prompt("Enter IPFS Audio Link:");
    const ipfsNft = prompt("Enter IPFS NFT Cover Link:");
    if (!ipfsAudio || !ipfsNft) return alert("IPFS links required.");
    await db.collection("submissions").doc(docId).update({
      certified: true,
      ipfsAudio,
      ipfsNft
    });
    alert("âœ… Certified!");
  }

  async function uploadLegacy() {
    const projectName = document.getElementById("legacyName").value;
    const twitter = document.getElementById("legacyHandle").value;
    const ipfsAudio = document.getElementById("legacyIpfsAudio").value;
    const ipfsNft = document.getElementById("legacyIpfsNft").value;
    if (!projectName || !twitter || !ipfsAudio || !ipfsNft) return;
    await db.collection("submissions").add({
      wallet: adminWallet,
      projectName,
      twitter,
      vibe: "Legacy",
      idea: "",
      timestamp: Date.now(),
      certified: true,
      ipfsAudio,
      ipfsNft
    });
    document.getElementById("legacyStatus").innerText = "âœ… Uploaded!";
  }

  function renderTrack(doc) {
    const data = doc.data();
    const div = document.createElement("div");
    div.className = data.certified ? "certified" : "pending";
    div.innerHTML = `
      <strong>${data.projectName}</strong><br>
      ${data.twitter} â€” <em>${data.vibe}</em><br>
      ${data.idea || ""}<br>
      ${data.certified ? `
        <img src="https://ipfs.io/ipfs/${data.ipfsNft}" width="100%" />
        <audio controls src="https://ipfs.io/ipfs/${data.ipfsAudio}"></audio>
      ` : ""}
    `;
    if (!data.certified && userAddress && userAddress.toLowerCase() === adminWallet.toLowerCase()) {
      const btn = document.createElement("button");
      btn.innerText = "Stamp This";
      btn.onclick = () => approveSubmission(doc.id);
      div.appendChild(btn);
    }
    return div;
  }

  async function loadSubmissions() {
    const snap = await db.collection("submissions").orderBy("timestamp", "desc").get();
    const certifiedList = document.getElementById("certifiedList");
    const pendingList = document.getElementById("pendingList");
    const adminPending = document.getElementById("adminPendingList");
    certifiedList.innerHTML = "";
    pendingList.innerHTML = "";
    adminPending.innerHTML = "";

    snap.forEach(doc => {
      const el = renderTrack(doc);
      if (doc.data().certified) {
        certifiedList.appendChild(el);
      } else {
        pendingList.appendChild(el);
        if (userAddress && userAddress.toLowerCase() === adminWallet.toLowerCase()) {
          adminPending.appendChild(el.cloneNode(true));
        }
      }
    });
  }

  document.getElementById("connectWallet").onclick = connectWallet;
  document.getElementById("submitTrack").onclick = submitTrack;
  document.getElementById("uploadLegacy").onclick = uploadLegacy;

  loadSubmissions();
</script>

</body>
</html>
